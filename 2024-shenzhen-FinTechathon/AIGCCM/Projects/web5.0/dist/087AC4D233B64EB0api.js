/*! 
 Build based on gin-vue-admin 
 Time : 1730113336000 */
import{a as e,o as a,c as l,b as t,e as o,w as i,K as u,L as s,h as r,g as p,D as d,aX as n,t as m,j as c,T as v,k as f,E as g,H as B}from"./087AC4D233B64EB0index.js";import{E as b}from"./087AC4D233B64EB0dialog.js";import"./087AC4D233B64EB0overlay.js";/* empty css                          */import"./087AC4D233B64EB0tag.js";import{E as h,a as C}from"./087AC4D233B64EB0select.js";import"./087AC4D233B64EB0scrollbar.js";/* empty css                      */import{E as y,a as A}from"./087AC4D233B64EB0table-column.js";import"./087AC4D233B64EB0checkbox.js";/* empty css                       */import{E as _}from"./087AC4D233B64EB0popover.js";import{a as E,E as D}from"./087AC4D233B64EB0form-item.js";/* empty css                      *//* empty css                     */import{g as j,d as w,f as V,a as k,u as x,c as U,b as G}from"./087AC4D233B64EB0api2.js";import{t as I}from"./087AC4D233B64EB0stringFun.js";import{_ as T}from"./087AC4D233B64EB0warningBar.js";import{t as z}from"./087AC4D233B64EB0doc.js";import{_ as P}from"./087AC4D233B64EB0_plugin-vue_export-helper.js";import{E as S}from"./087AC4D233B64EB0index25.js";import"./087AC4D233B64EB0index21.js";import"./087AC4D233B64EB0_Uint8Array.js";import"./087AC4D233B64EB0isEqual.js";import"./087AC4D233B64EB0index20.js";import"./087AC4D233B64EB0index22.js";import"./087AC4D233B64EB0token.js";import"./087AC4D233B64EB0strings.js";import"./087AC4D233B64EB0castArray.js";import"./087AC4D233B64EB0debounce.js";import"./087AC4D233B64EB0_initCloneObject.js";import"./087AC4D233B64EB0dropdown.js";import"./087AC4D233B64EB0_baseClone.js";const q={class:"gva-search-box"},F={class:"gva-table-box"},O={class:"gva-btn-list"},K={style:{"text-align":"right","margin-top":"8px"}},L={style:{"text-align":"right","margin-top":"8px"}},H={class:"gva-pagination"},R={class:"dialog-footer"},X=P(Object.assign({name:"Api"},{__name:"api",setup(P){const X=e=>{const a=N.value.filter((a=>a.value===e))[0];return a&&"".concat(a.label)},J=e([]),M=e({path:"",apiGroup:"",method:"",description:""}),N=e([{value:"POST",label:"创建",type:"success"},{value:"GET",label:"查看",type:""},{value:"PUT",label:"更新",type:"warning"},{value:"DELETE",label:"删除",type:"danger"}]),Q=e(""),W=e({path:[{required:!0,message:"请输入api路径",trigger:"blur"}],apiGroup:[{required:!0,message:"请输入组名称",trigger:"blur"}],method:[{required:!0,message:"请选择请求方式",trigger:"blur"}],description:[{required:!0,message:"请输入api介绍",trigger:"blur"}]}),Y=e(1),Z=e(0),$=e(10),ee=e([]),ae=e({}),le=()=>{ae.value={}},te=()=>{Y.value=1,$.value=10,se()},oe=e=>{$.value=e,se()},ie=e=>{Y.value=e,se()},ue=({prop:e,order:a})=>{e&&("ID"===e&&(e="id"),ae.value.orderKey=I(e),ae.value.desc="descending"===a),se()},se=async()=>{const e=await j({page:Y.value,pageSize:$.value,...ae.value});0===e.code&&(ee.value=e.data.list,Z.value=e.data.total,Y.value=e.data.page,$.value=e.data.pageSize)};se();const re=e=>{J.value=e},pe=e(!1),de=async()=>{const e=J.value.map((e=>e.ID)),a=await w({ids:e});0===a.code&&(c({type:"success",message:a.msg}),ee.value.length===e.length&&Y.value>1&&Y.value--,pe.value=!1,se())},ne=e(!1),me=async()=>{const e=await V();0===e.code&&c({type:"success",message:e.msg}),ne.value=!1},ce=e(null),ve=e("新增Api"),fe=e(!1),ge=e=>{switch(e){case"addApi":ve.value="新增Api";break;case"edit":ve.value="编辑Api"}Q.value=e,fe.value=!0},Be=()=>{ce.value.resetFields(),M.value={path:"",apiGroup:"",method:"",description:""},fe.value=!1},be=async()=>{ce.value.validate((async e=>{if(e)switch(Q.value){case"addApi":0===(await U(M.value)).code&&c({type:"success",message:"添加成功",showClose:!0}),se(),Be();break;case"edit":0===(await x(M.value)).code&&c({type:"success",message:"编辑成功",showClose:!0}),se(),Be();break;default:c({type:"error",message:"未知操作",showClose:!0})}}))};return(e,j)=>{const w=f,V=E,x=h,U=C,I=g,P=D,Q=B,he=_,Ce=y,ye=A,Ae=S,_e=b;return a(),l("div",null,[t("div",q,[o(P,{ref:"searchForm",inline:!0,model:ae.value},{default:i((()=>[o(V,{label:"路径"},{default:i((()=>[o(w,{modelValue:ae.value.path,"onUpdate:modelValue":j[0]||(j[0]=e=>ae.value.path=e),placeholder:"路径"},null,8,["modelValue"])])),_:1}),o(V,{label:"描述"},{default:i((()=>[o(w,{modelValue:ae.value.description,"onUpdate:modelValue":j[1]||(j[1]=e=>ae.value.description=e),placeholder:"描述"},null,8,["modelValue"])])),_:1}),o(V,{label:"API组"},{default:i((()=>[o(w,{modelValue:ae.value.apiGroup,"onUpdate:modelValue":j[2]||(j[2]=e=>ae.value.apiGroup=e),placeholder:"api组"},null,8,["modelValue"])])),_:1}),o(V,{label:"请求"},{default:i((()=>[o(U,{modelValue:ae.value.method,"onUpdate:modelValue":j[3]||(j[3]=e=>ae.value.method=e),clearable:"",placeholder:"请选择"},{default:i((()=>[(a(!0),l(u,null,s(N.value,(e=>(a(),r(x,{key:e.value,label:"".concat(e.label,"(").concat(e.value,")"),value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),o(V,null,{default:i((()=>[o(I,{type:"primary",icon:"search",onClick:te},{default:i((()=>j[17]||(j[17]=[p("查询")]))),_:1}),o(I,{icon:"refresh",onClick:le},{default:i((()=>j[18]||(j[18]=[p("重置")]))),_:1})])),_:1})])),_:1},8,["model"])]),t("div",F,[t("div",O,[o(I,{type:"primary",icon:"plus",onClick:j[4]||(j[4]=e=>ge("addApi"))},{default:i((()=>j[19]||(j[19]=[p("新增")]))),_:1}),o(Q,{class:"cursor-pointer",onClick:j[5]||(j[5]=e=>d(z)("https://www.bilibili.com/video/BV1kv4y1g7nT?p=7&vd_source=f2640257c21e3b547a790461ed94875e"))},{default:i((()=>[o(d(n))])),_:1}),o(he,{modelValue:pe.value,"onUpdate:modelValue":j[8]||(j[8]=e=>pe.value=e),placement:"top",width:"160"},{reference:i((()=>[o(I,{icon:"delete",disabled:!J.value.length,onClick:j[7]||(j[7]=e=>pe.value=!0)},{default:i((()=>j[22]||(j[22]=[p("删除")]))),_:1},8,["disabled"])])),default:i((()=>[j[23]||(j[23]=t("p",null,"确定要删除吗？",-1)),t("div",K,[o(I,{type:"primary",link:"",onClick:j[6]||(j[6]=e=>pe.value=!1)},{default:i((()=>j[20]||(j[20]=[p("取消")]))),_:1}),o(I,{type:"primary",onClick:de},{default:i((()=>j[21]||(j[21]=[p("确定")]))),_:1})])])),_:1},8,["modelValue"]),o(he,{modelValue:ne.value,"onUpdate:modelValue":j[11]||(j[11]=e=>ne.value=e),placement:"top",width:"160"},{reference:i((()=>[o(I,{icon:"Refresh",onClick:j[10]||(j[10]=e=>ne.value=!0)},{default:i((()=>j[26]||(j[26]=[p("刷新缓存")]))),_:1})])),default:i((()=>[j[27]||(j[27]=t("p",null,"确定要刷新Casbin缓存吗？",-1)),t("div",L,[o(I,{type:"primary",link:"",onClick:j[9]||(j[9]=e=>ne.value=!1)},{default:i((()=>j[24]||(j[24]=[p("取消")]))),_:1}),o(I,{type:"primary",onClick:me},{default:i((()=>j[25]||(j[25]=[p("确定")]))),_:1})])])),_:1},8,["modelValue"])]),o(ye,{data:ee.value,onSortChange:ue,onSelectionChange:re},{default:i((()=>[o(Ce,{type:"selection",width:"55"}),o(Ce,{align:"left",label:"id","min-width":"60",prop:"ID",sortable:"custom"}),o(Ce,{align:"left",label:"API路径","min-width":"150",prop:"path",sortable:"custom"}),o(Ce,{align:"left",label:"API分组","min-width":"150",prop:"apiGroup",sortable:"custom"}),o(Ce,{align:"left",label:"API简介","min-width":"150",prop:"description",sortable:"custom"}),o(Ce,{align:"left",label:"请求","min-width":"150",prop:"method",sortable:"custom"},{default:i((e=>[t("div",null,m(e.row.method)+" / "+m(X(e.row.method)),1)])),_:1}),o(Ce,{align:"left",fixed:"right",label:"操作",width:"200"},{default:i((e=>[o(I,{icon:"edit",type:"primary",link:"",onClick:a=>(async e=>{const a=await k({id:e.ID});M.value=a.data.api,ge("edit")})(e.row)},{default:i((()=>j[28]||(j[28]=[p("编辑")]))),_:2},1032,["onClick"]),o(I,{icon:"delete",type:"primary",link:"",onClick:a=>(async e=>{v.confirm("此操作将永久删除所有角色下该api, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{0===(await G(e)).code&&(c({type:"success",message:"删除成功!"}),1===ee.value.length&&Y.value>1&&Y.value--,se())}))})(e.row)},{default:i((()=>j[29]||(j[29]=[p("删除")]))),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),t("div",H,[o(Ae,{"current-page":Y.value,"page-size":$.value,"page-sizes":[10,30,50,100],total:Z.value,layout:"total, sizes, prev, pager, next, jumper",onCurrentChange:ie,onSizeChange:oe},null,8,["current-page","page-size","total"])])]),o(_e,{modelValue:fe.value,"onUpdate:modelValue":j[16]||(j[16]=e=>fe.value=e),"before-close":Be,title:ve.value},{footer:i((()=>[t("div",R,[o(I,{onClick:Be},{default:i((()=>j[30]||(j[30]=[p("取 消")]))),_:1}),o(I,{type:"primary",onClick:be},{default:i((()=>j[31]||(j[31]=[p("确 定")]))),_:1})])])),default:i((()=>[o(T,{title:"新增API，需要在角色管理内配置权限才可使用"}),o(P,{ref_key:"apiForm",ref:ce,model:M.value,rules:W.value,"label-width":"80px"},{default:i((()=>[o(V,{label:"路径",prop:"path"},{default:i((()=>[o(w,{modelValue:M.value.path,"onUpdate:modelValue":j[12]||(j[12]=e=>M.value.path=e),autocomplete:"off"},null,8,["modelValue"])])),_:1}),o(V,{label:"请求",prop:"method"},{default:i((()=>[o(U,{modelValue:M.value.method,"onUpdate:modelValue":j[13]||(j[13]=e=>M.value.method=e),placeholder:"请选择",style:{width:"100%"}},{default:i((()=>[(a(!0),l(u,null,s(N.value,(e=>(a(),r(x,{key:e.value,label:"".concat(e.label,"(").concat(e.value,")"),value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),o(V,{label:"api分组",prop:"apiGroup"},{default:i((()=>[o(w,{modelValue:M.value.apiGroup,"onUpdate:modelValue":j[14]||(j[14]=e=>M.value.apiGroup=e),autocomplete:"off"},null,8,["modelValue"])])),_:1}),o(V,{label:"api简介",prop:"description"},{default:i((()=>[o(w,{modelValue:M.value.description,"onUpdate:modelValue":j[15]||(j[15]=e=>M.value.description=e),autocomplete:"off"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"])])}}}),[["__scopeId","data-v-1b9b1205"]]);export{X as default};
