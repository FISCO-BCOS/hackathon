/*! 
 Build based on gin-vue-admin 
 Time : 1730113336000 */
import{i as e}from"./087AC4D233B64EB0index23.js";import{_ as t}from"./087AC4D233B64EB0_plugin-vue_export-helper.js";import{o as a,c as i,K as s,L as n,b as r,t as c,S as o,ao as d,m as h,Y as l,e as m}from"./087AC4D233B64EB0index.js";const y=[{id:1e4,name:"文物",categary:"",children:[{id:2,name:"三星堆",categary:""},{id:3,name:"古器物",categary:"",children:[{id:30101,name:"瓷器",categary:"",children:[{id:3010101,name:"青花瓷",categary:""},{id:3010102,name:"白瓷",categary:""},{id:3010103,name:"黑瓷",categary:""},{id:3010104,name:"珐琅彩",categary:""}]},{id:30102,name:"陶器",categary:""},{id:30103,name:"石器",categary:""},{id:30104,name:"骨器",categary:""}]},{id:4,name:"书卷",categary:"",children:[{id:30401,name:"四大名著",categary:""},{id:30402,name:"永乐大典",categary:""},{id:30403,name:"多宝塔碑",categary:""},{id:30404,name:"兰亭集序",categary:""}]}]},{id:2e4,name:"动物形象",categary:"",children:[{id:1599811251651,name:"龙",categary:""},{id:1599811251652,name:"凤凰",categary:""},{id:1599811251653,name:"牛",categary:""},{id:1599811251654,name:"马",categary:""},{id:1599811251655,name:"羊",categary:""},{id:1599811251656,name:"鹤",categary:""}]},{id:3e4,name:"文艺经典",categary:"",children:[{id:1599811494936,name:"小说",categary:""},{id:1599811494937,name:"戏剧",categary:""},{id:1599811494938,name:"唐诗",categary:""},{id:1599811494939,name:"宋词",categary:""},{id:1599811494930,name:"元曲",categary:""},{id:1599811494931,name:"绘画",categary:""}]},{id:9e4,name:"机器人",categary:"",children:[{id:1599814026913,name:"Robot",categary:""},{id:1599814026914,name:"自动执行工作的机器装置",categary:""},{id:1599814026915,name:"人工智能技术",categary:""},{id:1599814026916,name:"微型计算机",categary:""},{id:1599814026917,name:"电能",categary:""}]},{id:90010,name:"景点",categary:"",children:[{id:1599814026922,name:"北京",categary:""},{id:1599814026923,name:"江苏",categary:""},{id:1599814026924,name:"上海",categary:""},{id:1599814026925,name:"山东",categary:""},{id:1599814026926,name:"山西",categary:""}]},{id:90020,name:"电影",categary:"",children:[{id:1599814026931,name:"动作电影",categary:""},{id:1599814026932,name:"推理电影",categary:""},{id:1599814026933,name:"悬疑电影",categary:""},{id:1599814026934,name:"恐怖电影",categary:""},{id:1599814026935,name:"喜剧电影",categary:""}]},{id:90020,name:"流行元素",categary:"",children:[{id:1599814026941,name:"爆炸",categary:""},{id:1599814026942,name:"涂鸦",categary:""},{id:1599814026943,name:"气球",categary:""},{id:1599814026944,name:"羽毛",categary:""},{id:1599814026945,name:"闪光",categary:""}]},{id:90020,name:"歌曲",categary:"",children:[{id:1599814026951,name:"流行",categary:""},{id:1599814026952,name:"摇滚",categary:""},{id:1599814026953,name:"爵士",categary:""},{id:1599814026954,name:"古典",categary:""},{id:1599814026955,name:"弦乐",categary:""}]}],g=["文物","动物形象","文艺经典","机器人","景点","电影","流行元素","歌曲"];const p=e=>new Promise(((t,a)=>{let i=[];y.forEach((e=>{u(i,e,0)}));let s=[];for(let n of i)if(n.parentId.toString()===e){const{children:e,...t}=n;s.push({...t})}s.length>0?t(s):a(new Error("节点展开失败"))}));function u(e,t,a){const{children:i,...s}=t;e.push({...s,parentId:a}),i&&i.length>0&&i.forEach((a=>{u(e,a,t.id)}))}const f={id:"chart",class:"chart"};const C=t({name:"Charts",components:{},mixins:[],props:{chartList:{type:Array,required:!0}},watch:{chartList:{handler(e){this.formatData(e||[],!0)}}},data:()=>({myChart:"",seriesData:[],seriesLinks:[],lastClickId:""}),computed:{},methods:{async nodeClick(e){const t=this.seriesData.findIndex((t=>t.id===e.data.id)),a=this.seriesData[t];if(!a.isRoot)if(a.isClicked)a.isClicked=!1,this.seriesData.splice(t,1,a),this.removeChilds(a.id);else{this.lastClickId=a.id,a.isClicked=!0,this.seriesData.splice(t,1,a);let e=await p(a.id);this.formatData(e)}},initCharts(){this.myChart||(this.myChart=e(document.getElementById("chart")),this.myChart.on("click",(e=>{"node"===e.dataType&&(this.nodeClick(e),console.log("params",e))})));let t={animationDurationUpdate:1500,animationEasingUpdate:"quinticInOut",tooltip:{show:!1},series:[{type:"graph",layout:"force",legendHoverLink:!0,hoverAnimation:!0,edgeLabel:{position:"middle",normal:{formatter:"{c}",show:!0}},edgeSymbol:["arrow",""],force:{gravity:.1,edgeLength:[100,300],repulsion:350},roam:!0,draggable:!0,itemStyle:{normal:{color:"#00FAE1",cursor:"pointer",label:{show:!0,position:[-10,-15],textStyle:{color:"#fff",fontStyle:"normal",fontWeight:"bolder",fontFamily:"sans-serif",fontSize:12}},nodeStyle:{brushType:"both",borderColor:"rgba(255,215,0,0.4)",borderWidth:1}},emphasis:{shadowColor:"#00FAE1",shadowOffsetX:0,shadowOffsetY:0,shadowBlur:40,focus:"adjacency"}},lineStyle:{width:2,color:"source",curveness:.05},label:{color:"#00FAE1",fontSize:18},symbolSize:14,links:this.seriesLinks,data:this.seriesData,cursor:"pointer"}]};console.log("option",t),this.myChart.setOption(t)},formatData(e,t=!1){let a=[];const i=[],s=[];let n="";if(t){this.seriesData=[],this.seriesLinks=[],a=[].concat(e[0].children),n=e[0].id+"";const t={id:n,name:e[0].name,category:e[0].categary,isClicked:!0,isRoot:!0,symbolSize:30};i.push(t)}else a=[].concat(e),n=this.lastClickId;a.forEach(((e,t)=>{const a=e.id+"",r={id:a,parentId:n,category:e.categary,name:e.name,isClicked:!1};i.push(r),n!=e.id&&s.push({value:e.categary,target:n,source:a})})),this.seriesData.push(...i),this.seriesLinks.push(...s),this.initCharts()},removeChilds(e){let t=[],a=[],i=[];this.getDeleteParentIds(i,[e]),this.seriesData.map((e=>{i.includes(e.id)||t.push(e)})),this.seriesLinks.map((e=>{i.includes(e.source)||i.includes(e.target)||a.push(e)})),this.seriesData=[].concat(t),this.seriesLinks=[].concat(a),this.initCharts()},getDeleteParentIds(e,t){let a=[];this.seriesData.map((e=>{t.includes(e.parentId)&&a.push(e.id)})),a.length>0&&(e.push(...a),this.getDeleteParentIds(e,a))}},created(){},mounted(){},beforeDestroy(){}},[["render",function(e,t,s,n,r,c){return a(),i("div",f)}],["__scopeId","data-v-af289616"]]),v={class:"container"},w=["onClick"],D=["x","y","font-size","fill-opacity","fill"];const I=t({name:"Keywords",components:{},mixins:[],props:{},data:()=>({tags:[],RADIUS:200,ZRADIUS:200,CX:600,CY:300,speedX:Math.PI/360,speedY:Math.PI/360}),computed:{},methods:{nodeClick(e){this.$emit("searchData",e.text)},initTags(){const e=[...g];let t=[];const a=e.length;for(let i=0;i<a;i++){let s={},n=(2*(i+1)-1)/a-1,r=Math.acos(n),c=r*Math.sqrt(a*Math.PI);s.text=e[i],s.x=this.CX+this.RADIUS*Math.sin(r)*Math.cos(c),s.y=this.CY+this.RADIUS*Math.sin(r)*Math.sin(c),s.z=this.ZRADIUS*Math.cos(r),s.color="rgb("+parseInt(255*Math.random())+","+parseInt(255*Math.random())+","+parseInt(255*Math.random())+")",t.push(s)}this.tags=[].concat(t)},rotateX(e){var t=Math.cos(e),a=Math.sin(e);for(let n of this.tags){var i=(n.y-this.CY)*t-n.z*a+this.CY,s=n.z*t+(n.y-this.CY)*a;n.y=i,n.z=s}},rotateY(e){var t=Math.cos(e),a=Math.sin(e);for(let n of this.tags){var i=(n.x-this.CX)*t-n.z*a+this.CX,s=n.z*t+(n.x-this.CX)*a;n.x=i,n.z=s}},listener(e){var t=e.clientX-this.CX,a=e.clientY-this.CY;this.speedX=1e-4*t>0?Math.min(2e-5*this.RADIUS,1e-4*t):Math.max(2e-5*-this.RADIUS,1e-4*t),this.speedY=1e-4*a>0?Math.min(2e-5*this.RADIUS,1e-4*a):Math.max(2e-5*-this.RADIUS,1e-4*a)},resizeWindow(){let e=document.body.clientHeight,t=document.body.clientWidth;t*=.85,t>1200&&(this.CX=t/2),e-=150,this.CY=e/2;let a=Math.min(this.CY,this.CX)/2;a>200&&(this.RADIUS=a),this.initTags(),this.$emit("windowResize")}},created(){},mounted(){this.resizeWindow(),window.addEventListener("resize",this.resizeWindow),this.initTags(),setInterval((()=>{this.rotateX(this.speedX),this.rotateY(this.speedY)}),17)},beforeDestroy(){interval.value&&clearInterval(interval.value),window.removeEventListener("resize",this.resizeWindow)}},[["render",function(e,t,o,d,h,l){return a(),i("div",v,[(a(),i("svg",{class:"keywords",onMousemove:t[0]||(t[0]=e=>l.listener(e))},[(a(!0),i(s,null,n(h.tags,((e,t)=>(a(),i("a",{href:"javascript:void(0)",key:t,onClick:t=>l.nodeClick(e)},[r("text",{class:"text",x:e.x,y:e.y,"font-size":600/(600-e.z)*20,"fill-opacity":(400+e.z)/600,fill:e.color},c(e.text),9,D)],8,w)))),128))],32))])}],["__scopeId","data-v-1cfd4d7a"]]),z={class:"container"},k={class:"center"},x={class:"header"},S={class:"canvas"};const b=t({name:"KnowledgeGraph",components:{Keywords:I,Charts:C},mixins:[],props:{},data:()=>({searchContent:"",type:1,searchList:[]}),computed:{},methods:{async checkList(e){if(e||(e=this.searchContent),e){try{let a=await(t=e,new Promise(((e,a)=>{let i=[],s=y.filter((e=>e.name.indexOf(t)>=0));s&&s.length>0&&(i=s||[]),i.length>0?e(i):a()})));this.type=2,this.searchList=[].concat(a),await this.windowResize()}catch(a){alert("未查询到数据,请更改查询条件")}var t;this.windowResize()}else this.type=1},async windowResize(){const e=this.$refs.charts;e&&e.myChart&&e.myChart.resize()}},created(){},mounted(){this.type=1,this.$count.value=this.$count.value+1,1===this.$count.value&&(console.log("向数据、分类中添加"),g.push("红色经典"))},beforeDestroy(){}},[["render",function(e,t,s,n,c,y){const g=I,p=C;return a(),i("div",z,[r("div",k,[r("div",x,[o(r("input",{type:"text",class:"ipt","onUpdate:modelValue":t[0]||(t[0]=e=>c.searchContent=e),onKeydown:t[1]||(t[1]=h((e=>y.checkList()),["enter"])),placeholder:"搜索：文物试试"},null,544),[[d,c.searchContent]]),t[2]||(t[2]=r("p",{class:"tips"},[r("span",null,"搜索示例:文物")],-1))]),r("div",S,[o(m(g,{onSearchData:y.checkList,onWindowResize:y.windowResize},null,8,["onSearchData","onWindowResize"]),[[l,1===c.type]]),o(m(p,{ref:"charts",chartList:c.searchList},null,8,["chartList"]),[[l,2===c.type]])])])])}],["__scopeId","data-v-bf10b303"]]),M={id:"graph"},L={__name:"graph",setup:e=>(e,t)=>(a(),i("div",M,[m(b)]))};export{L as default};
