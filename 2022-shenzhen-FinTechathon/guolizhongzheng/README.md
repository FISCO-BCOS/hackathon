# 医元疗技术文档

## 一、项目简介：

医元疗是一个致力于运用区块链技术思想来改造传统医疗模式，高效地解决当前医疗系统面对病人医院地位不对等、事故究责难、数据孤岛化严重以及医疗资源分布不均匀这四大阻碍，增强医疗数据共享、流通能力，进而为医学研究提供充分数据、打破地缘壁垒与数据壁垒的医疗系统。

## 二、项目背景： 

目前，我国医疗信息化建设处于方兴未艾的时期，随着医学研究的进步和信息技术的发展，医疗数据信息化已成为未来医疗行业的发展趋势，各大医院也都部署着自己的医疗信息系统，为我国医疗数据的信息化积累了宝贵的经验。尽管我国医疗信息化建设取得了长足的进步，但是依旧存在着以下问题：

###	数据孤岛现象严重：
当前的各个医院之间、医院与体检中心之间都存在着数据壁垒，无法实现患者医疗检测数据交换，患者每次转院都需要重新进行医疗体检，患者不仅遭受无端的财产损失，也会耽误最佳治疗时间。

###	医患关系日趋紧张，难以追责医疗事故：
当前的医疗系统属于一个封闭式系统，医院拥有对于内部数据的所有权利，这使得患者在医疗维权的时候，无法获取充足的证据维护自身的权益，这就使得医疗事故无法准确、精准地追责。

###	医疗资源分布不均衡：
我国的医疗资源分布不均衡，呈现向发达城市集中的趋势，这样会造成医疗水平低下地区的患者无法得到有效的诊疗，最终导向长途跋涉到发达城市诊疗的结果，从而导致“看病看一天”、“跋涉三万公里只为看病”等医疗乱象的出现，迫切需要一种方法可以实现医疗援助的方法，解决当前的医疗问题。

###	患者没有动力共享医疗数据：
无论是医疗机构的管理和运营，疾病的治疗，还是新型药物的研发，以及医学研究的发展，医疗数据都是非常重要的基础。众所周知，数据的获取很大限制了现代医疗行业发展，高昂的获取数据成本，以及患者对自己隐私数据的重视，加深了医疗数据共享的难度，患者没有动力对自己的医疗数据进行共享，各大医疗机构也很难积极共享自己医疗研究成果。因此需要有一种方式来激励患者共享数据。合理、有效的激励机制，可以鼓励更多医疗机构和患者参与到数据共享中，并提供高质量、可靠的医疗数据。通过采取激励机制，促进患者和医疗机构共享医疗数据，自发性的为医学研究做出奉献。




## 三、项目目标：


### 1.  打破医疗信息壁垒：
本项目积极响应国家促进医疗向低层次渗透的号召，致力于与线上诊疗相结合的方法，打破医疗壁垒、地缘隔阂，实现高医疗水平地区对于低水平地区的医疗援助。使得医疗水平低的地区在线上就可以享受高水平医疗服务，促进医疗诊疗向线上化进化，减少“看病看一天”、“为了看病跋涉三千公里”等现象的发生。


### 2.  维护医疗数据安全：
医疗数据的安全保护，是当前医疗大数据应用中的重要和热点问题，本项目致力于维护医疗数据安全，采用区块链技术，建立一个去中心化,可追溯以及防篡改的系统,防止用户数据的泄露与恶意被篡改，结合智能合约对数据进行安全存储，为医疗数据的安全铸造铜墙铁壁。


### 3.  解决究责难问题：
本项目致力于解决目前医患关系紧张的现状，患者从挂号开始，到出院的整个流程都将进行上链，所有的诊断医生，开药证明，医疗处方等等在区块链上均不可更改， 医院无法偏袒医生，医生无法抵赖自己的医疗事故，患者也无法无缘故的抹黑医院，为打开医患关系的”死结”提供新思路。


### 4.  监督医院作风建设：
本项目致力于督促各医院提升作风建设，加强服务水平，以考核评分的方式督促各大医院全面加强医院工作人员作风建设，提高廉洁从业水平，提升医院品质，不断提升门诊、住院和患者总体满意度，为百姓提供透明、安全、便捷的品质医疗服务。



 


## 四、功能创新：

###	医疗机构评估机制：
本项目特意添加了积分评估机制，通过各个医疗机构的当前实际医疗水平来对每个医疗机构分配初始积分，根据各个医疗机构所出现的误诊、错诊、以及服务态度、用户反馈等方面来进行积分调整，从而实现医疗机构水平分层，促使医疗机构服务水平提升。


###	隐私、医疗数据共享安全保护：
本项目创新性的使用了CP-ABE算法，通过用户定义的一种访问结构来表达授权的属性集合。在访问结构中的集合就是授权集，相反，不在访问结构中的集合就是非授权集。用户可以选择对应的集合设置访问策略，以决定谁可以解密密文。本项目通过该算法实现了细粒度的共享数据访问控制，避免未经授权的非法实体对医疗数据进行越权访问，从而侵犯病人的隐私医疗数据，大大增强了数据的安全性与可靠性。


###	医疗诊治过程全程上链：
本项目应用区块链技术，为解决医患关系提供了一种新思路。患者从挂号到出院的全套流程都将进行详细的上链，医护人员在提交患者的电子病历之前需要进行数字签名，由于区块链得天独厚的优势，患者的医疗诊治过程无法被篡改且数据可追溯。如果在医治过程当中，发生医疗事故。医院不仅无法抵赖，患者方也将拥有充分的证据来进行医疗追责。


###	数据共享激励机制：
本项目采用量化医疗数据的方法，对于不同的病人患者按照贡献值的大小，以积分的形式来量化患者的医疗共享数据，从而划分不同的贡献等级。不同贡献等级会获取奖励反馈，从而得到不尽相同的定制化待遇，比如，排队就诊、预约挂号、购买药物、保报销等定制化的优惠或者福利。


###	利益分配策略：
本项目采用Shapley策略进行利益分配，各个医疗机构合作得到的科研成果，所获得的利益将采用Shapley策略进行分配，增加了利益分配的公平性，也促进了各个医疗机构的积极性。
 

## 五、项目方案与流程：

• 根据当前的医疗资源的分布的现状可知，主要的医疗信息服务和主要的数据存储节点都部署在大医院或者核心医疗机构，因此我们将客户端分为完备级客户端(全节点)，和轻量级客户端(轻节点)，完备级客户端用于存储所有的医疗数据，轻量级客户端不保存数据记录，只能对医疗数据进行查询操作。

• 本项目借助，区块链分布式，可信赖的特点，针对当前医患关系紧张，医疗信息难溯源，患者没有动力共享数据，医院作风建设，医疗机构利益分配策略五个方面，我们设立了包括注册，病历授权，全流程上链，数据共享与激励机制，科研成果利益分配，以及医院评估七大功能模块。


### 注册：

•  患者向医疗机构联盟链集群(Medical institutions alliance chain cluster,MIACC)申请成为轻量级客户端，MIACC对用户身份信息进行审核，审核通过后，用户自定义私钥，系统生成公钥对应用户地址。用户对应的轻量级客户端只能进行相关的查询和授权操作，无法对自身电子病历进行更改和添加操作。

•  医生向MIACC申请成为医院的在线客户端，审核通过后，医生自定义私钥，并通过MIACC系统生成公钥作为唯一标识，医生可以书写用户的电子病历本或者体检报告，通过医院的公钥对电子病历本或者体检报告进行加密后再上链，防止用户的隐私泄露。

•  医院向MIACC申请成为完备级客户端，并提交相应的资料，MIACC对医院的提交信息材料进行审核，审核通过后，医院自行定义私钥，医院可以通过MIACC生成对应的公钥，由公钥来标识医院的地址。由于医院是完备级客户端，因此医院可以对用户的信息进行上链，永久保存在区块链中，不可被篡改。

 

### 电子病历授权：
患者生成电子病历：
• 患者选择生成电子病历，系统将当前的时间戳和患者的身份证进行哈希运算得到的哈希值作为该电子病历的唯一标识符。
患者和医生进行授权：
• 患者通过数字签名的方式对该电子病历进行授权，主治医生对患者的电子病历同样进行数字签名，当该电子病历拥有两者的签名时才可以被医生书写，并上传至联盟链。
 全流程上链：
• 患者从挂号，取就诊号，门诊看病，化验，缴费拿药或住院等流程都将由响应的医生进行数字签名操作， 记录在患者的电子病历中。

• 患者的EMR将由主治医生上传至MIACC，经过上链后的数据。医院和患者只能进行查询操作，不可被篡改。


 



### 数据共享：
• 本项目创新性的使用了CP-ABE算法，患者自定义访问集合，选择想要共享的医疗机构或者其他患者，制定某张电子病历或者体检报告的访问控制策略。患者选择与访问集合中的元素共同协商生成密钥以及加密算法，对医疗数据进行上链。只有在访问集合中并且知晓访问策略的元素才可以解密并且查看。

• 为保护用户的隐私信息，用户可以对共享的医疗数据进行脱敏处理，抹去隐私信息。与此同时，为了保护用户对该医疗数据的拥有权，患者可以将违规的医疗机构移出访问集合，被移出访问集合中的元素将无权查看用户医疗数据，并且可以对违规机构进行投诉以及举报。


 



### 积分激励机制：

• 本项目创新性的采用积分激励机制，激励患者与医疗机构共享医疗数据与解决方案。激励积分由三种组成，共享积分，价值积分，稀有程度。其中共享积分占比30%，价值积分占比40%，稀有程度占比30%。

• 医疗数据共享等级分为不共享、一级共享、二级共享。一级共享是指数据拥有者允许某个患者或者医疗机构对电子病历或者体检报告查看，但是不能进行学术交流共享操作；二级共享是指允许医疗机构查看自己的体检报告或者电子病历，并用来做学术交流。不共享的数据无法获得额外加分，一级共享加1分，二级共享加2分。随着共享的医院增多，通过数据共享获取的积分也会增加。

• 医疗机构会对患者共享的医疗数据进行价值评估，医疗数据价值分为三个等级，分为三个等级，其中等级为一的数据可加5分，等级为二的数据可加20分，等级为三的数据加30分，以积分的形式来量化数据的价值，进行分数激励。

• 医疗机构会对患者共享医疗数据进行稀有程度评估，医疗稀缺程度分为三个等级，一级稀缺加5分，二级稀缺加15分，三级稀缺加25分，稀缺程度越高的医疗数据将获得更高的积分。




###	 科研成果利益分配：
本项目创新性的采用Shapley策略，为医疗机构科研成果进行利益分配，根据各大机构所作出的贡献以及承担的风险综合评判Shapley值，公平分配利益值，激发科研机构的创造力，从而构建良好的创新生态。只有在良好的氛围和灵活的评价机制下，给人才成长提供足够的空间，才能使各类人才都能有效发挥出才能。


###	医院评估机制：
本项目针对某些医院医疗建设作风的问题，设立医院医疗水平评估机制，每个医院都会初始分配积分，根据诊前服务，诊后服务，医疗误诊率，疑难杂症救治率，患者反馈等进行评估考核，量化医院医疗水平。

##  六、核心算法:

信息熵（information entropy）：

熵泛指某些物质状态的一种量度，通常用来度量系统微观状态的混乱程度，分布越混乱，熵值越大。信息熵（information entropy）是信息论的基本概念，常用于描述信息源各可能事件发生的不确定性。 信息熵的提出解决了对信息的量化度量问题。在基于区块链的医疗数据共享平台中，医疗数据的信息熵越大，说明该条数据与其他医疗机构发生交互的概率越大，交易越频繁，数据有更高的价值。 


基于Shapley值的利益分配策略：

Shapley值法是一种利益分配策略，它旨在获取与自己贡献相等的回报，避免了分配上的平均主义。联盟链内的医疗机构相互合作，研究出的科研成果进行数据共享之后，将采用Shapley策略来对各个医疗机构进行利益分配，从而促进联盟内的节点相互博弈，共同进步。在Shapley值的利益分配策略中，n个医疗机构进行科研合作，医疗机构的增加不会引起效益的减少。设集合I={1，2，3，4……n}，Ⅰ为n个医疗机构构成的集合，对于Ⅰ的任一字集S，都对应一个实值函数V(S），均满足：
V(\emptyset)=0;
V(s1\cups2)>=V(s1)+V(s2)，S1\capS2=\emptyset\ \ (\mathbit{S}_\mathbf{1}\subseteq\mathbit{I}\ \ \mathbit{S}_\mathbf{2}\subseteq\mathbit{I}) (医疗机构合作获得的最大效益大于各自研究所获得的效益之和);

设[Ⅰ,V]为n个医疗机构的合作策略，函数V被称为对策的特征函数。通常情况下，我们用Xi表示i成员从合作的最大效益V(Ⅰ)中应得到的一份收益。在合作Ⅰ的基础下，合作对策的分配用x=(x1, x2, x3, x4…xn)表示，显然如果医疗机构合作要成功，则必须满足如下条件：
\sum_{\mathbit{i}=\mathbf{1}}^{\mathbit{n}}\mathbit{X}i=V(Ⅰ)  且：Xi>=V(i)
\mathbit{\phi}\left(\mathbit{V}\right)=φ1，φ2，φ3…….φn

在Shapley值法中，合作I下的各个伙伴所得利益分配称为Shapley值，并记作：
其中\mathbit{\phi}\left(\mathbit{V}\right)表示在合作I 下面各个医疗机构所获得的利益总值，\mathbit{\varphi}_{\mathbit{i}(\mathbit{v})} 表示在合作\mathbf{I}\ \ 下第i个成员员所得的利益分配，可由下式求得：
\mathbit{\varphi}_{\mathbit{i}(\mathbit{v})}=\sum_{\mathbit{s}\in\mathbit{s}_\mathbit{i}}\mathbit{W}\left(\left|\mathbit{s}\right|\right)\left[\mathbit{V}\left(\mathbit{s}\right)-\mathbit{V}\left(\mathbit{s}\\mathbit{i}\right)\right] i=1，2，3…n
\mathbit{W}\left(\left|\mathbit{s}\right|\right)=  \frac{\left(\mathbit{n}-\left|\mathbit{s}\right|\right)!\ast\left(\left|\mathbit{s}\right|-\mathbf{1}\right)!}{\mathbit{n}!}
 


## 同态加密(Homomorphic Encryption, HE)：

同态加密技术是一种基于数学难题的计算复杂性理论的密码学技术。它支持数据直接以密态的方式进行计算,如加法和乘法以及混合运算。与此同时，在对密文进行处理的过程中，不会泄露原文的任何信息。计算得到的结果仍然是加密的，持有密钥的用户对同态加密处理后的密文数据进行解密后得到的结果，与原文经过对应的处理后得到的结果一致。
Paillie半同态加密方案：
Paillie是一种加性同态公钥加密系统，该系统在需要密文加法计算的场合表现的极为突出。在许多PHE方案中，Paillier方案以效率高、安全可靠等特点备受推崇，已广泛应用于加密信号处理和第三方数据处理领域，同时也是隐私计算领域中最常用的PHE方案之一。 

密钥生成:

1. 随机选取两个较大的质数p和q, 计算他们的乘积N；
2. 计算 \mathbit{\gamma}=\mathbit{lcm}(\mathbit{q}-\mathbf{1},\mathbit{p}-\mathbf{1})，这里lcm代表的是最小公倍数；
3. 随机选取参数g，g\inZ*N2，其中ZN2 为N2中小于N2整数的集合，Z*N2是在ZN2中与N2互质的整数集合；
5. g满足公式 : gcd(L(gymodN),N)=1，其中函数L满足函数L(u)=L(u-1)/N；
6. 公钥为(N,g)，私钥为\mathbit{\gamma}
加密过程:
1.输入明文信息M，M\in\mathbit{Z}N;
2.选取随机数r，0<=r<N;
3.密文为S=(gM * rN)modN2;
解密过程：
1.输入密文S 满足S\in\mathbit{Z}*N ;
2.计算明文:M=L(SymodN2) /L（gymodN2）;

Paillier公钥密码体制加法同态特性分析:
这里可以通过E(a)和E(b)计算出E(a+b)的值，而不需要知道a与b的值，假设有密文E(a)和E(b)，他们满足以下关系：
其中D(X)为解密算法，g为公钥，r1,r2为随机数，0<=r1<N，0<=r2<N；
D(E(a)E(y)modN2)
=D((gar1N)\otimes(gbr2N)modN2modN2)
=D(ga+b(r1*r2)NmodN2)
=a+bmodN
 
## 智能推荐算法：
大多数患者对于具体医护人员的业务水平没有很明确的认知，这就需要我们系统根据用户的偏好以及需求来进行医护人员推荐，这样不仅仅有利于提高自身的市场竞争力，也可以保证为用户提供与其需求匹配的医疗服务，增加用户的医疗服务体验，部分单位技术人员提出了为指定用户进行医疗服务提供方信息智能推荐的方式，收集大量用户系统使用数据，并使用智能算法对数据进行筛选，选择其中的价值性数据作为决策数据，通过对数据的集中分析，进行医疗服务与用户地区、需求度、倾向度的匹配，通过此种方式促进医疗服务同用户需求一致，为用户提供良好的使用体验。

基于协同过滤算法的医疗服务智能推荐：

### 1、用户偏好度确定
假设医元疗的注册用户数量为p ，医疗服务提供数量为q ，则注册用户集合可以表示为 U ={u1,u2,L,up} ，对应的电商平台产品信 息可以表示为I = [I1,I2,L,Ip]。建立面向用户的医疗服务评分矩阵，将矩阵表示为vij ，则vij可以代表用户ui对医疗服务Ij的评分。在上述内容中，i的取 值在1~p 之间，j 的取值在1～q 之间。 其中vij在空间中的分布是具体某个数值，如果用户u i没 有对医疗服务I j进行打分，此时对应用户的vij取值为0。在上述的基础上

我们引进slope one 方法进行电商平台用户偏好度确定。

                       Step1：\mathbit{R}ij=u∈N(i)∩N(j) （γui-γuj）|N（i）∩N(j)|
  
          其中，rui为用户u对于医疗服务i的评分，ruj为用户u对于医疗服务j的评分，N(i)表示已经对医疗服务i评分过的用户，而N(j)则表示已经对医疗服务j评分过的用户，|N(i)\cap N(j)|则表示对于医疗服务i以及医疗服务j都进行过评分的人数。

                      Step2：\mathbit{P}\left(\mathbit{ij}\right)=\ \frac{\sum_{\mathbit{i}\in\mathbit{N}(\mathbit{u})}{|\mathbit{N}(\mathbit{i})\cap\mathbit{N}(\mathbit{j})|(\mathbit{r}_{\mathbit{ui}}-\mathbit{R}(\mathbit{ij}))}}{\sum_{\mathbit{i}\in\mathbit{N}(\mathbit{u})}{|\mathbit{N}(\mathbit{i})\cap\mathbit{N}(\mathbit{j})|}}

   其中，N(u)表示用户u评分过的所有医疗服务的集合

Step3：将预测评分排序，取topN对应的医疗服务推荐给用户。

在使用slope one算法过程中，可以假设两个电商 产品I j与 I i在用户中的评分数值为g 与 h，此时，可以根据g与h的线性关系， 进行系统用户偏好度的分析。明确用户u i对医疗服务I j与I i的偏好度存在差异，将偏好度差异表示为\mathbit{\delta}_{\mathbit{ij}}，对\mathbit{\delta}_{\mathbit{ij}}进行计算，公式如下
                                                 \delta\left(ij\right)=\ Ij-uiN[Wij(x)]

其中，N表示用户偏好度的布尔空间分布方式；W表示数据线性回归处理手段；x表示数据拟合计算公式。

完成上述运算之后，进行vij的计算，从而得到具体的用户偏好度数值。计算公式如下：
                                             \mathbf{v}_{\mathbf{ij}}=\ \frac{\mathbf{1}}{||\mathbf{Z}_\mathbf{i}||}\sum_{\mathbf{m}\in\mathbf{B}_\mathbf{i}}{(\mathbf{v}_{\mathbf{im}}+\mathbit{\delta}_{\mathbf{im}})}

其中，Zi表示用户对某项医疗服务信息的综合评分集合;||Zi||表示评分集合中元素的具体数量；vim表示用户对某项医疗服务信息的历史评分真实取值；B表示信息划分类别；\mathbit{\delta}_{\mathbit{im}}表示Ij项目在评分过程中的具体权重值。

然后将现有的数据划分为n个类别，对每个类别的信息进行一次map处理，对所有数据之间的map键值进行输出。在此过程中如果map输出了K种键位值， 则可以按对K个键位值进行并行处理得到不同用户对医疗服务信息的偏好度，但如果map输出的键位值小于K种，我们就可以认为在此过程中，存在用户未对服务做出评价，从而通过此种方式确定系统用户偏好度。
### 2、基于协同过滤算法的用户与推荐信息匹配度计算
  
  获取目标用户与已注册用户中的其他用户存在的相似操作行为，我们就可以得到一组或若干组数据，我们将这些数据集合作为“最近邻居”。获取这些相似系统用户的行为数据之后，我们需要使用协同过滤算法中的相似关系系数，进行用户在平台中行为相似度的计算。计算公式如下：
                                           \complement_{ab}\ =\ \frac{\sum_{j}{(d_{aj}-\bar{d})(d_{bj}-\bar{d})}}{\sqrt{\sum_{j}{(d_{aj}-\bar{d})}^2}\sqrt{\sum_{j}{(d_{bj}-\bar{d})}^2}}

其中，C表示用户在平台中行为相 似度；a 表示目标用户；b 表示“最近邻居”用户； d表示历史行为；\bar{d} 表示存在交叉的历史行为。

完成计算后， 需要采用聚类的方式，确定“最近邻居”的数量，假设 a 的周围存在若干个”最近邻居”。此时，应确定一个中心点，选择与a 相似度或者匹配度最高的b作为中心点，通过此种方式，我们就可以实现对“最近邻居”用户的协同过滤。可以使用如下算式来表示过滤处理：
                                                       w=\ \frac{1}{j}\sum_{j>1}^{1}D

    其中，w表示“最近邻居”用户协同过滤处理过程；D表示选定的过滤中心点,即与某个用户相似度最高的“最近邻居”。

掌握相关信息之后，我们就会对用户的网络行为数据进行集成，然后对具有相似行为习惯的用户进行服务信息推荐；对于医疗服务的过滤我们同样使用过滤“最近邻居”的过程进行过滤。在过滤的过程当中，我们使用如下的算式进行匹配度计算：
                                                       A=Sim\left(i,j\right)\alpha\astH

其中，A表示用户与推荐信息匹配度计算结果；Sim表示数据信息聚类处理过程；\alpha 表示相似度评价指标权重； H表示信息在空间中的欧式距离。

按照上述的计算公式，我们可以得到A 的具体值，然后就对A 进行量化处理，定义A 取值为0-1中的一个数值，如果计算结果越趋近于1， 证明推荐的医疗服务信息与用户 的需求越匹配，反之，计算结果越趋近0，证明推荐的医疗服务信息与用户的需求匹配度越差。

### 3、基于数据挖掘的医疗服务信息个性化推荐

在上述的基础上，我们可以引进关联规则来计算不同的医疗服务在平台中的用户支持度。计算公式如下：
                                                        T_{R\rightarrow B}=\ \beta\frac{1}{\xi_R\cap\xi_P}

其中，TR->P表示用户R对产品P的 支持度；\beta表示关联规则；\xi_R表示产服务R最高支持阈值； \xi_P表示服务P的最高支持阈值。

然后我们就按照如下公式可以进行数据的挖掘：
\varepsilon=\ \frac{\varsigma_1}{\varsigma_2\ast Q}

其中， \varepsilon表示产品信息价值与用户 兴趣度的挖掘过程； \varsigma_1表示产品信息 在空间中的置信程度； \varsigma_2表示产品信 息在所有属性产品中的推荐价值； Q表示数据挖掘维度。

挖掘后，输出非空子集的项数集合\eta，将其作为医疗服务信息的推荐内容。在此基础上，我们再对此部分信息与用户需求匹配度进行计算，确保算法可以承担为用户自主推荐医疗的服务。
 
### PBFT共识算法：
在一个分布式网络中，假设全部节点的数量为N，恶意节点的数量为f，PBFT算法可以确保当恶意节点数量少于全网节点的1/3即满足N≥3f+1时全网对消息达成共识。PBFT算法包含一个主节点和其余的从节点，当主节点正常工作时，消息需要经过请求(request)、预准备(pre-prepare)、准备(prepare)、承诺(commit)、答复(reply)5个阶段，如果主节点出错或不能及时处理数据，则启动视图转换协议从备份节点中选择新的主节点继续完成工作。

PBFT算法的共识过程如下：

(1)客户端向主节点发送请求；

(2)主节点在收到请求后生成预准备消息发送给全网备份节点；

(3)备份节点在收到预准备消息后首先进行验证，验证通过后生成准备消息发送给全网节点，
同时监听网络中来自其他节点的准备消息；

(4)在节点收到大于或等于2f+1个节点的准备消息后生成承诺消息，同时监听网络中来自其他节点的承诺消息；

(5)当节点收到大于或等于2f+1个节点的承诺消息后完成对消息的承诺，并更新自己的日志，同时将承诺信息反馈给客户端。当客户端收到超过f个节点的承诺信息时，表明该请求被大多数节点确认。流程如图所示。

 


 ### Merkle Tree：
在Fisco Bcos的区块链系统中，采用Merkle Tree的方式存储联盟链的数据存储，Merkle Tree由一个根节点，一组中间节点和一组叶节点组成，叶节点包含存储数据或其哈希值，中间节点是它的两个孩子节点内容的哈希值，根节点也是由它的两个子节点内容的哈希值组成。所以Merkle树也称哈希树。
 

## 七、应用落地场景：

大湾区医疗一体化进程的大力推进，使区块链医疗出现了新的生机，通过大湾区医疗一体化的实现，本项目可以实现医疗数据的共享，不同地区之间的跨境医疗服务衔接得以实现，成功打破医疗的地缘隔阂；实现不同地区的优势互补、发挥出协同效应，构造出真正完善且高水平的医疗体系；加强公共医疗资源协作，实现医疗器材、用品以及医药等资源的协作，使得跨境患者无需回港，即可与当地居民使用相同的医疗资源。本项目助推大湾区医疗融合，推动跨境医疗服务衔接，为医疗行业的发展作出贡献。
## 八 、技术栈：
技术	说明	版本号
Solidity	智能合约编程语言	0.4.25
SpringBoot	Spring快速开发框架	2.1.1.RELEASE
Spring	Java框架	5.1.3.RELEASE
SpringMVC	 JavaWeb 框架	5.1.3.RELEASE
MyBatis/MyBatis-Plus	持久层框架	3.5.9
WeBASE-Front接口	RPC接口交互	1.5.4
Fastjson	JSON解析库	1.2.76
Swagger	接口文档框架	2.0
OkHttp	HTTP请求库	3.4.2
Hutool	Java工具类库	5.4.3
Lombok	Java插件	1.18.10
SQL	结构化查询语言	2005
HTML	超文本标记语言	5
CSS	层叠样式表	3
JavaScript	解释性脚本语言	ES5
Vue	前端Web框架	2.6.12
Element-UI	前端UI框架	2.15.1
Bootstrap	前端UI框架	3.3.5
Axios	Ajax库	1.0.0
九、系统与开发环境：
 硬件环境
硬件	配置	备注
CPU	i5或更高	AMD Ryzen 7 4800H或更高
主频	3.20GHZ或更高	
内存	8GB以上	DDR4
显卡	2GB以上	独立显卡
硬盘	1T	固态
 软件环境
软件	版本	作用	备注
Windows 10 专业工作站版	21H2	操作系统	内部版本号19044.2006
VMware-workstation	15	操作系统虚拟化软件	商业破解版
Ubuntu	20.04.5	Linux 发行版	Live Server 版
FISCO BCOS	2.8.0	联盟链系统	开源
WeBASE-Front	2.8.0	联盟链中间件	开源
JDK（Linux）	8u141	Java 开发SDK工具包	开源
MobaXterm	20.6	Linux 终端仿真器	绿色版
Visual Studio Code	1.72	前端集成开发工具（IDE）	开源
IDEA	2019.2.4	Java 集成开发工具（IDE）	商业破解版
MySQL	8.0.22	数据库	开源
Navicat	15	数据库GUI终端访问软件	商业破解版
JDK(windows)	8u202	Java开发SDK工具包	开源
Maven	3.5.4	Java Jar包管理软件	开源
Draw.io	18.0.6	绘图软件	开源
Postman	6.1.4	接口测试工具	开源



